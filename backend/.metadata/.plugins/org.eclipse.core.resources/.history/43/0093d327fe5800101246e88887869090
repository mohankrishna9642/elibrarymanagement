package com.elibrary.bookservice.config;



import org.apache.logging.log4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {
	  private static final Logger logger = LoggerFactory.getLogger(WebConfig.class);
	

    @Value("${book.upload.directory}")
    private String uploadDirectory;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // This tells Spring MVC that any URL starting with /books/
        // should be served from the file system location specified by uploadDirectory.
        // It converts the file:// URL to a valid path.
        registry.addResourceHandler("/books/**") // The URL path pattern (e.g., http://localhost:8080/books/filename.pdf)
                .addResourceLocations("file:" + uploadDirectory + "/"); // The physical file system path
        // Important: Ensure there is a trailing slash in "file:" + uploadDirectory + "/"
        // This ensures the /books/ prefix is correctly stripped and the file is looked up directly in the directory.
        logger.debug("WebConfig: Configured resource handler: /books/** -> file:{}", uploadDirectory); // Add logging
    }
}